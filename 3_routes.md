3_routes
Для работы веб сервера необходимо, чтобы он обрабатывал запросы от клиентов. В первую очередь, необходимо связать url адреса с полезной бизнес логикой.

Для этого создадим route – обработчик фреймворка, который связывает http запрос на определённый адрес с функцией обработчиком.

Для того, чтобы наш код стал более упорядоченным, чтобы по его структуре можно было легко понять назначение, чтобы его в дальнейшем можно было легко расширять, будем придерживаться строгой структуры папок.

Создадим папку `routes`, и в ней файл c описанием наших рутов для работы с сущностями – `CurrencyRoutes.js`

Кстати, далее мы будем все файлы именовать в PascalCase – начинать с заглавной буквы и новые части имени начинать также с заглавной.

```js
module.exports = (app) => {
	app.get(`/currencies`, async (req, res) => {
		return res.send("OK");
	});
}
```

Рассмотрим содержимое этого файла. Все руты экземпляра объекта express объявляются с помощью функций, схожих с названием метода, который должен быть обработан.
В данном случае, объявлен путь `/currencies` для метода `GET`.

Теперь в файле `index.js` необходимо добавить этот файл, передав ему экземпляр express.

Добавим строки

`CurrencyRoutes = require(`${global.baseDir}/routes/CurrencyRoutes.js`);`

И

`CurrencyRoutes(app);`

Запустим сервер. Теперь, если перейти по адресу `http://localhost:3233/currencies`, то мы увидим ответ “Ok”.

### Профайлинг

Во-первых, у нас непосредственно в коде располагается номер порта сервера. Это уже нехорошо, так как это изменяемый параметр – настройка сервера, а не логика работы.

Поэтому создадим отдельный файл, в котором разместим все наши настройки.

`/options/Settings.js`

Перенесём туда настройки сервера

```json
server: {
	schema: "http",
	host: "localhost",
	port: 3233
},
```

И подключим этот файл

Далее, в нашем проекте может быть много рутов. Поэтому подключать их все внутри `index.js` мы не хотим, дабы не захламлять код. Создадим отдельный файл `routes/index.js`, который будет отвечать за подключение рутов

```js
const routes = ['CurrencyRoutes.js'];

module.exports = async (app) => {
	for (const path of routes) {
		const route = require(`${global.baseDir}/routes/${path}`);
		await route(app);
	}
}
```

Важно, что этот код в дальнейшем может быть легко модифицирован. Например, автоматически получать содержимое папки с рутами или фильтровать ненужные руты в зависимости от потребностей

Но и на этом мы не остановимся!

Часто сервера требуют смены API, обновления и пр. Для этого добавим версионность рутов. 

Заменим рут
`/currencies`
На 
`/api/v1/currencies`

Этот начальный префикс `/api/v1` добавим в наш файл настроек и буем передавать его параметром в наши руты.

```js
const { Settings } = require(`${global.baseDir}/options/Settings.js`); 
const routes = ['CurrencyRoutes.js'];

module.exports = async (app) => {
	
	const BASE = Settings.api.base;
	
	for (const path of routes) {
		const route = require(`${global.baseDir}/routes/${path}`);
		await route({ app, BASE });
	}
}
```

И
```js
module.exports = ({ app, BASE }) => {
	
	app.get(`/currencies`, async (req, res) => {
		return res.send("OK");
	});
	
}
```

Так как мы будем использовать соглашение `REST`, то все наши руты для currencies будут иметь похожую структуру, поэтому упростим код так

```js
module.exports = ({ app, BASE }) => {
	
	BASE = BASE + '/currencies';
	
	app.get(`${BASE}`, async (req, res) => {
		return res.send("OK");
	});
	
}
```

Запустим сервер, и перейдём на url
`http://localhost:3233/api/v1/currencies`

